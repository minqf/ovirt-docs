<?xml version="1.0"?>
<section id="References_oVirt_3_Log_Collector">
   <title>Log Collector</title>

<!-- A Reference provides additional information -->
	<para>
		The oVirt Engine installation includes a log collection tool. This allows you to easily collect relevant logs from across the oVirt environment when requesting support. 
	</para>
	<para>
		The log collection command is <command>ovirt-log-collector</command>. You must be logged in as the <systemitem class="username">root</systemitem> user to run it successfully. You must provide the administration credentials for the oVirt environment on the command line. Full usage information, including a list of all valid options for the command,  is available by running the <command>ovirt-log-collector <parameter>-h</parameter></command> command.
	</para> 
	<section>
		<title>Syntax</title>
		<para>
			The basic syntax is of the form:
		</para>
<screen>
Usage: <command>ovirt-log-collector <parameter><replaceable>[options]</replaceable></parameter> <parameter>list</parameter> <parameter>[all, clusters, datacenters]</parameter></command>
       <command>ovirt-log-collector <parameter><replaceable>[options]</replaceable></parameter> <parameter>collect</parameter></command>
</screen>
		<para>
			The two supported modes of operation are <parameter>list</parameter>, and <parameter>collect</parameter>.
		</para>
		<itemizedlist>
			<listitem>
				<para>
					The <parameter>list</parameter> parameter lists either the hosts, clusters, or data centers attached to the oVirt Engine. You are then able to filter log collection based on the listed objects.
				</para>
			</listitem>
			<listitem>
				<para>
					The <parameter>collect</parameter> parameter performs log collection from the oVirt Virtualization Manager. The collected logs are placed in an archive file under the <filename>/tmp/logcollector</filename> directory. The <command>ovirt-log-collector</command> command outputs the specific filename that it chose to use  when log collection is completed.
				</para>
			</listitem>
		</itemizedlist>
		<para>
			The default action taken if no parameters are provided is to list available hosts along with the data center, and cluster, to which they belong. Where necessary the log collector will prompt you to enter usernames and passwords required to retrieve logs.
		</para>
		<para>
			The <command>ovirt-log-collector</command> command has a large number of options. You can use these options to further refine the scope of log collection. 
		</para>
		<variablelist>
			<title>General Options</title>
			<varlistentry>
				<term><parameter>--version</parameter></term>
				<listitem>
					<para>
						Displays the version number of the command in use, and exits immediately.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>-h</parameter>, <parameter>--help</parameter></term>
				<listitem>
					<para>
						Displays command usage information, and exits immediately.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--conf-file=<replaceable>PATH</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>PATH</replaceable> as the configuration file the tool is to use.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--local-tmp=<replaceable>PATH</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>PATH</replaceable> as the directory to which retrieved logs are to be saved. Default is <filename>/tmp/logcollector</filename>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--ticket-number=<replaceable>TICKET</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>TICKET</replaceable> as the ticket, or case number, to associate with the <acronym>SOS</acronym> report.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--upload=<replaceable>FTP_SERVER</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>FTP_SERVER</replaceable> as the destination for retrieved logs to be sent using <acronym>FTP</acronym>. Do not use this option unless advised to by a oVirt support representative.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--quiet</parameter></term>
				<listitem>
					<para>
						Sets quiet mode, reducing console output to a minimum. This is off by default.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--log-file=<replaceable>PATH</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>PATH</replaceable> as the log file the command should use for its own log output. Note that this is not to be confused with the <parameter>--local-tmp</parameter> parameter.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>-v</parameter>, <parameter>--verbose</parameter></term>
				<listitem>
					<para>
						Sets verbose mode, providing more console output. This is off by default.
					</para>
				</listitem>
			</varlistentry>
		</variablelist>
		<variablelist>
			<title>oVirt Engine Options</title>
			<para>
				The options in the oVirt Engine configuration group are used to specify the engine authentication details and, filter log collection from one or more virtualization hosts. Note that it is possible to combine the options used to select the virtualization hosts, for example selecting all host in clusters <literal>A</literal> and <literal>B</literal> where the name of the host matches pattern <literal>SalesHost*</literal>.
			</para>
			<varlistentry>
				<term><parameter>--no-nodes</parameter></term>
				<listitem>
					<para>
						Sets the option to skip collection of logs from the virtualization hosts.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>-u <replaceable>USER</replaceable></parameter>, <parameter>--user=<replaceable>USER</replaceable></parameter></term>
				<listitem>
					<para>
						Sets the username to log in as to <replaceable>USER</replaceable>. This must be a username that exists in directory services, and is known to the oVirt Engine. The user must be specified in the format <replaceable>user</replaceable>@<replaceable>domain</replaceable>, where <replaceable>user</replaceable> is replaced by the username, and <replaceable>domain</replaceable> is replaced by the directory services domain in use.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>-r <replaceable>FQDN</replaceable></parameter>, <parameter>--ovirt=<replaceable>FQDN</replaceable></parameter></term>
				<listitem>
					<para>
						Sets the oVirt Engine to connect to as <replaceable>FQDN</replaceable>. <replaceable>FQDN</replaceable> must be replaced by the fully qualified domain name of the engine. By default it is assumed that the log collector is being run on the same machine as the engine. Therefore the default value for this parameter is <literal>localhost</literal>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>-c <replaceable>CLUSTER</replaceable></parameter>, <parameter>--cluster <replaceable>CLUSTER</replaceable></parameter></term>
				<listitem>
					<para>
						Collect all logs from the oVirt Engine, as well as virtualization hosts in the cluster named <replaceable>CLUSTER</replaceable>. The cluster(s) for inclusion must be specified in a comma separated list of cluster names or match patterns.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>-d <replaceable>DATACENTER</replaceable></parameter>, <parameter>--data-center <replaceable>DATACENTER</replaceable></parameter></term>
				<listitem>
					<para>
						Collect all logs from the oVirt Engine, as well as virtualization hosts in the data center named <replaceable>DATACENTER</replaceable>. The data center(s) for inclusion must be specified as a comma separated list of data center names or match patterns. 
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>-H <replaceable>HOSTS_LIST</replaceable></parameter>, <parameter>--hosts=<replaceable>HOSTS_LIST</replaceable></parameter></term>
				<listitem>
					<para>
						Collect all logs from the oVirt Engine, as well as virtualization hosts included in <replaceable>HOSTS_LIST</replaceable>. The hosts for inclusion must be specified as a comma separated list of hostnames, fully qualified domain names, or <acronym>IP</acronym> addresses. Match patterns for each type of value are also valid.
					</para>
				</listitem>
			</varlistentry>
		</variablelist>
		<variablelist>
			<title><acronym>SOS</acronym> Report Options</title>
			<para>
				The <acronym>JBoss</acronym> <acronym>SOS</acronym> plugin is always executed by log collector. To activate data collection from the <acronym>JMX</acronym> console the <parameter>--java-home</parameter>, <parameter>--jboss-user</parameter>, and <parameter>jboss-pass</parameter> parameters must also be provided.
			</para>
			<varlistentry>
				<term><parameter>--jboss-home=<replaceable>JBOSS_HOME</replaceable></parameter></term>
				<listitem>
					<para>
						<acronym>JBoss</acronym> installation directory path. Default is <filename>/var/lib/jbossas</filename>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--java-home=<replaceable>JAVA_HOME</replaceable></parameter></term>
				<listitem>
					<para>
						Java installation directory path. Default is <filename>/usr/lib/jvm/java</filename>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--jboss-profile=<replaceable>JBOSS_PROFILE</replaceable></parameter></term>
				<listitem>
					<para>
						Quoted and space separated list of server profiles. This is used to limit log collection to the specified profiles. The default is <parameter>'ovirt-slimmed'</parameter>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--enable-jmx</parameter></term>
				<listitem>
					<para>
						Enable the collection of run-time metrics from oVirt's <acronym>JBoss</acronym> <acronym>JMX</acronym> interface.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--jboss-user=<replaceable>JBOSS_USER</replaceable></parameter></term>
				<listitem>
					<para>
						<acronym>JBoss</acronym> <acronym>JMX</acronym> invoker user to be used with twiddle. Default is <parameter>admin</parameter>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--jboss-logsize=<replaceable>LOG_SIZE</replaceable></parameter></term>
				<listitem>
					<para>
						Maximum size for each log file retrieved, in <acronym>MB</acronym>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--jboss-stdjar=<replaceable>STATE</replaceable></parameter></term>
				<listitem>
					<para>
						Sets collection of <acronym>JAR</acronym> statistics for <acronym>JBoss</acronym> standard <acronym>JARs</acronym>. Replace <replaceable>STATE</replaceable> with <literal>on</literal>, or <literal>off</literal>. The default is <literal>on</literal>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--jboss-servjar=<replaceable>STATE</replaceable></parameter></term>
				<listitem>
					<para>
						Sets collection of <acronym>JAR</acronym> statistics from any server configuration directories. Replace <replaceable>STATE</replaceable> with <literal>on</literal>, or <literal>off</literal>. The default is <literal>on</literal>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--jboss-twiddle=<replaceable>STATE</replaceable></parameter></term>
				<listitem>
					<para>
						Sets collection of twiddle data on, or off. Twiddle is the <acronym>JBoss</acronym>	tool used to collect data from the <acronym>JMX</acronym> invoker.  Replace <replaceable>STATE</replaceable> with <literal>on</literal>, or <literal>off</literal>. The default is <literal>on</literal>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--jboss-appxml=<replaceable>XML_LIST</replaceable></parameter></term>
				<listitem>
					<para>
						Quoted and space separated list of applications whose <acronym>XML</acronym> descriptions should be retrieved. Default is <literal>'all'</literal>.
					</para>
				</listitem>
			</varlistentry>
		</variablelist>
		<variablelist>
			<title><acronym>SSH</acronym> Configuration</title>
			<varlistentry>
				<term><parameter>--ssh-host=<replaceable>PORT</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>PORT</replaceable> as the port to use for <acronym>SSH</acronym> connections with virtualization hosts.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>-k <replaceable>KEYFILE</replaceable></parameter>, <parameter>--key-file=<replaceable>KEYFILE</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>KEYFILE</replaceable> as the public <acronym>SSH</acronym> key to be used for accessing the virtualization hosts.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--max-connections=<replaceable>MAX_CONNECTIONS</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>MAX_CONNECTIONS</replaceable> as the maximum concurrent <acronym>SSH</acronym> connections for logs from virtualization hosts. The default is <literal>10</literal>.
					</para>
				</listitem>
			</varlistentry>
		</variablelist>
		<variablelist>
			<title>PostgreSQL Database Options</title>
			<para>
				The log collector connects to the oVirt Engine database and dumps it for inclusion in the log report if <parameter>pg-pass</parameter> is specified. The database username, and database name also must be specified if they were changed from the default values during installation.
			</para>
			<para>
				Where the database is not on the local machine set the <parameter>pg-dbhost</parameter>, and optionally supply a <parameter>pg-host-key</parameter>, to collect remote logs. The PostgreSQL <acronym>SOS</acronym> plugin must be installed on the database server for remote log collection to be successful.
			</para>
			<varlistentry>
				<term><parameter>--no-postgresql</parameter></term>
				<listitem>
					<para>
						Disables collection of database. Database collection is performed by default.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--pg-user=<replaceable>USER</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>USER</replaceable> as the username to use for connections with the database server. The default is <systemitem>postgres</systemitem>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--pg-dbname=<replaceable>DBNAME</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>DBNAME</replaceable> as the database name to use for connections with the database server. The default is <systemitem>ovirt</systemitem>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--pg-dbhost=<replaceable>DBHOST</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>DBHOST</replaceable> as the hostname for the database server. The default is <systemitem>localhost</systemitem>.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term><parameter>--pg-host-key=<replaceable>KEYFILE</replaceable></parameter></term>
				<listitem>
					<para>
						Sets <replaceable>KEYFILE</replaceable> as the public identity file (private key) for the database server. This value is not set by default as it is not required where the database exists on the local host.
					</para>
				</listitem>
			</varlistentry>
		</variablelist>
	</section>
	<section>
		<title>Examples</title>
		<example>
			<title>Basic Log Collector Usage</title>
			<para>
				In this example log collector is run to collect all logs from the oVirt Engine and the three attached hosts. Additionally the database and <acronym>JBoss</acronym> logs are also collected.  
			</para>
<screen>
# <command>ovirt-log-collector</command>
Please provide the username for ovirt (CTRL+D to abort): admin@directory.demo.redhat.com
Please provide the password for ovirt (CTRL+D to abort): 
Host list (datacenter=None, cluster=None, host=None):
Data Center          | Cluster              | Hostname/IP Address
SalesDataCenter      | SalesCluster         | 192.168.122.250
EngineeringDataCenter | EngineeringCluster   | 192.168.122.251
FinanceDataCenter    | FinanceCluster       | 192.168.122.252
# <command>ovirt-log-collector collect</command>
Please provide the username for ovirt (CTRL+D to abort): admin@directory.demo.redhat.com
Please provide the password for ovirt (CTRL+D to abort): 
About to collect information from 3 nodes. Continue? (Y/n): Y
INFO: Gathering information from selected nodes...
INFO: collecting information from 192.168.122.250
INFO: collecting information from 192.168.122.251
INFO: collecting information from 192.168.122.252
INFO: finished collecting information from 192.168.122.250
INFO: finished collecting information from 192.168.122.251
INFO: finished collecting information from 192.168.122.252
Please provide the password to dump the PostgreSQL database (CTRL+D to abort): 
INFO: Gathering PostgreSQL the oVirt-M database and log files from localhost...
INFO: Gathering oVirt-M information...
Please provide the password for jboss (CTRL+D to abort): 
INFO: Log files have been collected and placed in /tmp/logcollector/sosreport-rhn-account-20110804121320-ce2a.tar.xz.
      The MD5 for this file is 6d741b78925998caff29020df2b2ce2a and its size is 26.7M
</screen>
	
		</example>
	</section>

   <!-- Do not edit below this line! -->

   <!-- Injection Point: Related Overviews -->
   <!-- Injection Point: Related Concepts -->
   <!-- Injection Point: Related Tasks -->
</section>